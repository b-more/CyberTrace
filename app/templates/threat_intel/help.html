{% extends "base.html" %}

{% block title %}Threat Intelligence Help - CyberTrace{% endblock %}

{% block content %}
<div class="container-fluid py-4">
    <!-- Interactive Header -->
    <div class="text-center mb-5">
        <h1 class="display-4">
            <i class="bi bi-shield-fill-exclamation text-danger"></i>
            Threat Intelligence System
        </h1>
        <p class="lead">Interactive Guide & Tutorial</p>
        <p class="text-muted">Learn how to use CyberTrace's powerful threat intelligence features</p>
    </div>

    <!-- Quick Navigation -->
    <div class="card shadow-sm mb-4 border-primary">
        <div class="card-header bg-primary text-white">
            <h5 class="mb-0"><i class="bi bi-compass"></i> Quick Navigation</h5>
        </div>
        <div class="card-body">
            <div class="row text-center">
                <div class="col-md-3 mb-3">
                    <a href="#what-is-it" class="btn btn-outline-primary w-100">
                        <i class="bi bi-question-circle" style="font-size: 2rem;"></i><br>
                        What Is It?
                    </a>
                </div>
                <div class="col-md-3 mb-3">
                    <a href="#how-it-works" class="btn btn-outline-success w-100">
                        <i class="bi bi-gear" style="font-size: 2rem;"></i><br>
                        How It Works
                    </a>
                </div>
                <div class="col-md-3 mb-3">
                    <a href="#step-by-step" class="btn btn-outline-info w-100">
                        <i class="bi bi-list-ol" style="font-size: 2rem;"></i><br>
                        Step-by-Step
                    </a>
                </div>
                <div class="col-md-3 mb-3">
                    <a href="#examples" class="btn btn-outline-warning w-100">
                        <i class="bi bi-lightbulb" style="font-size: 2rem;"></i><br>
                        Examples
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- Section 1: What Is It? -->
    <div id="what-is-it" class="card shadow-sm mb-4">
        <div class="card-header bg-info text-white">
            <h3 class="mb-0"><i class="bi bi-1-circle"></i> What is Threat Intelligence?</h3>
        </div>
        <div class="card-body">
            <div class="row">
                <div class="col-md-8">
                    <h5 class="text-primary">Simple Explanation:</h5>
                    <p class="lead">
                        Threat Intelligence is like a <strong>national database of scammers and criminals</strong>
                        that helps you instantly check if a phone number, email, or website has been used in fraud.
                    </p>

                    <div class="alert alert-success">
                        <h6><i class="bi bi-check-circle"></i> What You Can Do:</h6>
                        <ul class="mb-0">
                            <li>Check if a phone number is used in scams</li>
                            <li>Verify if an email address is malicious</li>
                            <li>Detect phishing websites and domains</li>
                            <li>Find IP addresses involved in cybercrime</li>
                            <li>Track patterns across multiple cases</li>
                        </ul>
                    </div>

                    <h5 class="text-primary mt-4">Two Types of Intelligence:</h5>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="card border-success mb-3">
                                <div class="card-header bg-success text-white">
                                    <strong>1. Local Zambian Database</strong>
                                </div>
                                <div class="card-body">
                                    <p class="small">Threats reported by:</p>
                                    <ul class="small">
                                        <li>Zambian citizens</li>
                                        <li>Police investigations</li>
                                        <li>Other law enforcement</li>
                                    </ul>
                                    <span class="badge bg-success">100% Zambian Data</span>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="card border-primary mb-3">
                                <div class="card-header bg-primary text-white">
                                    <strong>2. Global Threat Feeds</strong>
                                </div>
                                <div class="card-body">
                                    <p class="small">5 international sources:</p>
                                    <ul class="small">
                                        <li>AlienVault OTX (19M+ threats)</li>
                                        <li>URLhaus (malicious URLs)</li>
                                        <li>ThreatFox (IoC database)</li>
                                        <li>AbuseIPDB (IP abuse)</li>
                                        <li>Cisco Talos (reputation)</li>
                                    </ul>
                                    <span class="badge bg-primary">Global Coverage</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col-md-4">
                    <div class="card bg-light">
                        <div class="card-body">
                            <h6 class="text-primary">Real-World Example:</h6>
                            <div class="alert alert-warning mb-3">
                                <p class="small mb-0">
                                    <strong>Scenario:</strong> A citizen reports being scammed by +260971234567
                                    for K5,000 in a mobile money fraud.
                                </p>
                            </div>
                            <p class="small">
                                <i class="bi bi-arrow-down"></i> System saves this to database
                            </p>
                            <div class="alert alert-info mb-3">
                                <p class="small mb-0">
                                    Next day, another officer investigates +260971234567 for a different case
                                </p>
                            </div>
                            <p class="small">
                                <i class="bi bi-arrow-down"></i> System alerts the officer
                            </p>
                            <div class="alert alert-success mb-0">
                                <p class="small mb-0">
                                    <strong><i class="bi bi-exclamation-triangle"></i> MATCH!</strong>
                                    This number has 1 previous report, K5,000 loss
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Section 2: How It Works -->
    <div id="how-it-works" class="card shadow-sm mb-4">
        <div class="card-header bg-success text-white">
            <h3 class="mb-0"><i class="bi bi-2-circle"></i> How Does It Work?</h3>
        </div>
        <div class="card-body">
            <h5 class="text-primary">System Architecture</h5>

            <div class="row mb-4">
                <div class="col-md-12">
                    <div class="card border-primary">
                        <div class="card-body">
                            <div class="row text-center">
                                <div class="col-md-2">
                                    <div class="p-3 bg-light rounded">
                                        <i class="bi bi-person-circle" style="font-size: 3rem;"></i>
                                        <p class="small mb-0 mt-2"><strong>Investigator</strong></p>
                                    </div>
                                </div>
                                <div class="col-md-1 d-flex align-items-center justify-content-center">
                                    <i class="bi bi-arrow-right" style="font-size: 2rem;"></i>
                                </div>
                                <div class="col-md-2">
                                    <div class="p-3 bg-primary text-white rounded">
                                        <i class="bi bi-search" style="font-size: 3rem;"></i>
                                        <p class="small mb-0 mt-2"><strong>Search</strong></p>
                                    </div>
                                </div>
                                <div class="col-md-1 d-flex align-items-center justify-content-center">
                                    <i class="bi bi-arrow-right" style="font-size: 2rem;"></i>
                                </div>
                                <div class="col-md-2">
                                    <div class="p-3 bg-success text-white rounded">
                                        <i class="bi bi-cpu" style="font-size: 3rem;"></i>
                                        <p class="small mb-0 mt-2"><strong>Process</strong></p>
                                    </div>
                                </div>
                                <div class="col-md-1 d-flex align-items-center justify-content-center">
                                    <i class="bi bi-arrow-right" style="font-size: 2rem;"></i>
                                </div>
                                <div class="col-md-2">
                                    <div class="p-3 bg-warning rounded">
                                        <i class="bi bi-shield-check" style="font-size: 3rem;"></i>
                                        <p class="small mb-0 mt-2"><strong>Results</strong></p>
                                    </div>
                                </div>
                            </div>

                            <hr>

                            <h6 class="text-primary mt-4">Behind the Scenes:</h6>
                            <div class="accordion" id="workflowAccordion">
                                <div class="accordion-item">
                                    <h2 class="accordion-header">
                                        <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#step1">
                                            <strong>Step 1:</strong> &nbsp; You enter a phone number/email/domain
                                        </button>
                                    </h2>
                                    <div id="step1" class="accordion-collapse collapse show" data-bs-parent="#workflowAccordion">
                                        <div class="accordion-body">
                                            <p>Example: You search for <code>+260xxxxxxxxx</code></p>
                                            <p>The system validates the format and prepares it for checking.</p>
                                        </div>
                                    </div>
                                </div>

                                <div class="accordion-item">
                                    <h2 class="accordion-header">
                                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#step2">
                                            <strong>Step 2:</strong> &nbsp; System checks Local Zambian Database
                                        </button>
                                    </h2>
                                    <div id="step2" class="accordion-collapse collapse" data-bs-parent="#workflowAccordion">
                                        <div class="accordion-body">
                                            <p>Searches for matches in threats reported by:</p>
                                            <ul>
                                                <li>Citizens via public reporting form</li>
                                                <li>Previous police investigations</li>
                                                <li>Partner agencies (other police units)</li>
                                            </ul>
                                            <p><strong>Speed:</strong> Instant (milliseconds)</p>
                                        </div>
                                    </div>
                                </div>

                                <div class="accordion-item">
                                    <h2 class="accordion-header">
                                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#step3">
                                            <strong>Step 3:</strong> &nbsp; System checks 5 Global Threat Feeds (Parallel)
                                        </button>
                                    </h2>
                                    <div id="step3" class="accordion-collapse collapse" data-bs-parent="#workflowAccordion">
                                        <div class="accordion-body">
                                            <p>Simultaneously queries all 5 sources:</p>
                                            <ol>
                                                <li><strong>AlienVault OTX:</strong> Checks 19 million threat indicators</li>
                                                <li><strong>URLhaus:</strong> Checks malicious URL database</li>
                                                <li><strong>ThreatFox:</strong> Checks IoC (Indicators of Compromise)</li>
                                                <li><strong>AbuseIPDB:</strong> Checks IP abuse reports</li>
                                                <li><strong>Cisco Talos:</strong> Checks email/domain reputation</li>
                                            </ol>
                                            <p><strong>Speed:</strong> 2-5 seconds (parallel processing)</p>
                                        </div>
                                    </div>
                                </div>

                                <div class="accordion-item">
                                    <h2 class="accordion-header">
                                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#step4">
                                            <strong>Step 4:</strong> &nbsp; System calculates Threat Score (0-100)
                                        </button>
                                    </h2>
                                    <div id="step4" class="accordion-collapse collapse" data-bs-parent="#workflowAccordion">
                                        <div class="accordion-body">
                                            <p>Aggregates results and calculates:</p>
                                            <ul>
                                                <li><strong>Threat Score:</strong> 0-100 (higher = more dangerous)</li>
                                                <li><strong>Risk Level:</strong> Clean, Low, Medium, High, Critical</li>
                                                <li><strong>Sources Found:</strong> How many databases flagged it</li>
                                            </ul>
                                            <div class="alert alert-info">
                                                <strong>Example Calculation:</strong>
                                                <ul class="mb-0">
                                                    <li>Found in 3 sources = High confidence</li>
                                                    <li>Multiple reports = Higher score</li>
                                                    <li>Recent activity = Critical priority</li>
                                                </ul>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="accordion-item">
                                    <h2 class="accordion-header">
                                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#step5">
                                            <strong>Step 5:</strong> &nbsp; Results displayed to you
                                        </button>
                                    </h2>
                                    <div id="step5" class="accordion-collapse collapse" data-bs-parent="#workflowAccordion">
                                        <div class="accordion-body">
                                            <p>You see:</p>
                                            <ul>
                                                <li>Overall threat score and risk level</li>
                                                <li>Which sources found it</li>
                                                <li>Detailed findings from each source</li>
                                                <li>Related cases (if any)</li>
                                                <li>Financial losses reported</li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="alert alert-warning">
                <h6><i class="bi bi-lightning"></i> Automatic Integration:</h6>
                <p class="mb-0">
                    Threat intelligence is <strong>automatically checked</strong> when you run:
                </p>
                <ul class="mb-0">
                    <li>Phone OSINT investigations</li>
                    <li>Email OSINT investigations (coming soon)</li>
                    <li>Domain investigations (coming soon)</li>
                </ul>
                <p class="mt-2 mb-0">
                    <strong>You don't have to do anything extra - it just works!</strong>
                </p>
            </div>
        </div>
    </div>

    <!-- Section 3: Step-by-Step Guide -->
    <div id="step-by-step" class="card shadow-sm mb-4">
        <div class="card-header bg-warning">
            <h3 class="mb-0"><i class="bi bi-3-circle"></i> Step-by-Step: How to Use</h3>
        </div>
        <div class="card-body">
            <div class="row">
                <div class="col-md-6">
                    <h5 class="text-primary">Method 1: Dashboard Search (Manual)</h5>

                    <div class="card mb-3">
                        <div class="card-header bg-primary text-white">
                            <strong>Step 1: Go to Threat Intelligence</strong>
                        </div>
                        <div class="card-body">
                            <p>In the sidebar, click:</p>
                            <p><i class="bi bi-shield-exclamation"></i> <strong>Threat Dashboard</strong></p>
                            <p class="text-muted small">Or go directly to Search Threats</p>
                        </div>
                    </div>

                    <div class="card mb-3">
                        <div class="card-header bg-primary text-white">
                            <strong>Step 2: Click "Search Threats"</strong>
                        </div>
                        <div class="card-body">
                            <p>On the dashboard, click the <strong>"Search Threats"</strong> button</p>
                            <p class="text-muted small">This opens the search interface</p>
                        </div>
                    </div>

                    <div class="card mb-3">
                        <div class="card-header bg-primary text-white">
                            <strong>Step 3: Enter Indicator</strong>
                        </div>
                        <div class="card-body">
                            <p>Enter what you want to check:</p>
                            <ul>
                                <li>Phone: <code>+260xxxxxxxxx</code></li>
                                <li>Email: <code>scammer@example.com</code></li>
                                <li>Domain: <code>fake-bank.com</code></li>
                                <li>IP: <code>192.168.1.1</code></li>
                            </ul>
                        </div>
                    </div>

                    <div class="card mb-3">
                        <div class="card-header bg-primary text-white">
                            <strong>Step 4: Choose Options</strong>
                        </div>
                        <div class="card-body">
                            <p><strong>Indicator Type:</strong> Auto-detect (recommended) or select manually</p>
                            <p><strong>Search External Sources:</strong> Check this box to query global databases (recommended)</p>
                        </div>
                    </div>

                    <div class="card mb-3">
                        <div class="card-header bg-success text-white">
                            <strong>Step 5: View Results</strong>
                        </div>
                        <div class="card-body">
                            <p>You'll see:</p>
                            <ul class="mb-0">
                                <li><strong>Local Results:</strong> Zambian database matches</li>
                                <li><strong>Global Results:</strong> International threat feeds</li>
                                <li><strong>Threat Score:</strong> 0-100 rating</li>
                                <li><strong>Risk Level:</strong> Clean/Low/Medium/High/Critical</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <div class="col-md-6">
                    <h5 class="text-primary">Method 2: Automatic (During Investigation)</h5>

                    <div class="card mb-3 border-success">
                        <div class="card-header bg-success text-white">
                            <strong>This happens automatically!</strong>
                        </div>
                        <div class="card-body">
                            <p class="lead">When you run a <strong>Phone OSINT</strong> investigation:</p>

                            <div class="alert alert-info">
                                <p class="mb-2"><strong>1. Go to Phone OSINT</strong></p>
                                <p class="small text-muted">Investigations → Phone OSINT</p>
                            </div>

                            <div class="alert alert-info">
                                <p class="mb-2"><strong>2. Enter phone number normally</strong></p>
                                <p class="small text-muted">Example: +260xxxxxxxxx</p>
                            </div>

                            <div class="alert alert-info">
                                <p class="mb-2"><strong>3. Select case and run investigation</strong></p>
                                <p class="small text-muted">As you normally would</p>
                            </div>

                            <div class="alert alert-success">
                                <p class="mb-2"><strong>4. Threat intelligence is automatically included!</strong></p>
                                <p class="small mb-0">
                                    In the results, scroll down to see the <strong>"Threat Intelligence"</strong> section
                                </p>
                            </div>

                            <hr>

                            <p class="text-success"><strong><i class="bi bi-check-circle"></i> No extra steps needed!</strong></p>
                            <p class="small mb-0">
                                The system automatically checks every phone number against all threat databases
                                and shows the results in your investigation report.
                            </p>
                        </div>
                    </div>

                    <h5 class="text-primary mt-4">Method 3: Public Reporting (For Citizens)</h5>

                    <div class="card border-info">
                        <div class="card-header bg-info text-white">
                            <strong>Anyone can report threats!</strong>
                        </div>
                        <div class="card-body">
                            <p><strong>URL:</strong> <code>/threat-intel/public/report</code></p>
                            <p>Citizens can:</p>
                            <ul>
                                <li>Report scam phone numbers</li>
                                <li>Report phishing emails</li>
                                <li>Report fake websites</li>
                                <li>Report financial losses</li>
                            </ul>
                            <p class="mb-0"><strong>No login required!</strong> Anyone can help build the database.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Section 4: Real Examples -->
    <div id="examples" class="card shadow-sm mb-4">
        <div class="card-header bg-danger text-white">
            <h3 class="mb-0"><i class="bi bi-4-circle"></i> Real-World Examples</h3>
        </div>
        <div class="card-body">
            <h5 class="text-primary">Example 1: Mobile Money Scam</h5>
            <div class="card mb-4 border-warning">
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <h6 class="text-warning">Scenario:</h6>
                            <p>Officer investigates complaint about +260971234567 claiming to be from MTN requesting mobile money PIN.</p>

                            <h6 class="text-warning">Action:</h6>
                            <ol>
                                <li>Officer runs Phone OSINT on +260971234567</li>
                                <li>System automatically checks threat intelligence</li>
                            </ol>
                        </div>
                        <div class="col-md-6">
                            <h6 class="text-success">Result:</h6>
                            <div class="alert alert-danger">
                                <p class="mb-1"><strong>⚠️ THREAT DETECTED!</strong></p>
                                <p class="small mb-0">
                                    <strong>Threat Score:</strong> 92/100 (Critical)<br>
                                    <strong>Found in:</strong> Local database<br>
                                    <strong>Previous Reports:</strong> 8 reports<br>
                                    <strong>Financial Loss:</strong> K45,000<br>
                                    <strong>Pattern:</strong> MTN mobile money scam
                                </p>
                            </div>
                            <h6 class="text-success">Officer Action:</h6>
                            <p class="small mb-0">
                                Officer immediately knows this is part of a scam campaign,
                                links case to previous 8 cases, and fast-tracks arrest warrant.
                            </p>
                        </div>
                    </div>
                </div>
            </div>

            <h5 class="text-primary">Example 2: Phishing Email Investigation</h5>
            <div class="card mb-4 border-info">
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <h6 class="text-info">Scenario:</h6>
                            <p>Victim received email from <code>support@zanaco-secure.com</code> asking for account details.</p>

                            <h6 class="text-info">Action:</h6>
                            <ol>
                                <li>Officer searches domain <code>zanaco-secure.com</code></li>
                                <li>Checks "Search External Sources"</li>
                            </ol>
                        </div>
                        <div class="col-md-6">
                            <h6 class="text-success">Result:</h6>
                            <div class="alert alert-warning">
                                <p class="mb-1"><strong>⚠️ SUSPICIOUS DOMAIN!</strong></p>
                                <p class="small mb-0">
                                    <strong>Threat Score:</strong> 88/100 (High)<br>
                                    <strong>Found in:</strong> URLhaus, ThreatFox<br>
                                    <strong>Category:</strong> Phishing<br>
                                    <strong>Registered:</strong> 2 days ago<br>
                                    <strong>Real Zanaco:</strong> zanaco.co.zm (different!)
                                </p>
                            </div>
                            <h6 class="text-success">Officer Action:</h6>
                            <p class="small mb-0">
                                Officer confirms phishing attack, warns public via social media,
                                contacts hosting provider to take down site, identifies 12 victims.
                            </p>
                        </div>
                    </div>
                </div>
            </div>

            <h5 class="text-primary">Example 3: Clean Number (No Threat)</h5>
            <div class="card border-success">
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <h6 class="text-success">Scenario:</h6>
                            <p>Officer investigates +260977777777 mentioned in case notes.</p>

                            <h6 class="text-success">Action:</h6>
                            <p>Officer searches the number in threat intelligence.</p>
                        </div>
                        <div class="col-md-6">
                            <h6 class="text-success">Result:</h6>
                            <div class="alert alert-success">
                                <p class="mb-1"><strong>✓ CLEAN</strong></p>
                                <p class="small mb-0">
                                    <strong>Threat Score:</strong> 0/100<br>
                                    <strong>Risk Level:</strong> Clean<br>
                                    <strong>Local Reports:</strong> None<br>
                                    <strong>Global Sources:</strong> Not found in any database
                                </p>
                            </div>
                            <h6 class="text-success">Officer Action:</h6>
                            <p class="small mb-0">
                                Officer proceeds with normal investigation,
                                knowing this number has no history of fraud.
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Quick Reference Card -->
    <div class="card shadow-sm mb-4 border-primary">
        <div class="card-header bg-primary text-white">
            <h4 class="mb-0"><i class="bi bi-bookmark"></i> Quick Reference Card</h4>
        </div>
        <div class="card-body">
            <div class="row">
                <div class="col-md-6">
                    <h6 class="text-primary">Threat Score Guide:</h6>
                    <table class="table table-sm table-bordered">
                        <tr>
                            <td><span class="badge bg-success">0-20</span></td>
                            <td>Clean / No threat</td>
                        </tr>
                        <tr>
                            <td><span class="badge bg-info">21-40</span></td>
                            <td>Low risk</td>
                        </tr>
                        <tr>
                            <td><span class="badge bg-warning">41-60</span></td>
                            <td>Medium risk - investigate</td>
                        </tr>
                        <tr>
                            <td><span class="badge bg-danger">61-80</span></td>
                            <td>High risk - priority</td>
                        </tr>
                        <tr>
                            <td><span class="badge bg-danger">81-100</span></td>
                            <td>Critical - immediate action</td>
                        </tr>
                    </table>
                </div>
                <div class="col-md-6">
                    <h6 class="text-primary">Access Points:</h6>
                    <table class="table table-sm">
                        <tr>
                            <th>Feature</th>
                            <th>Location</th>
                        </tr>
                        <tr>
                            <td>Dashboard</td>
                            <td><code>/threat-intel/dashboard</code></td>
                        </tr>
                        <tr>
                            <td>Search</td>
                            <td><code>/threat-intel/search</code></td>
                        </tr>
                        <tr>
                            <td>Public Report</td>
                            <td><code>/threat-intel/public/report</code></td>
                        </tr>
                        <tr>
                            <td>Help Guide</td>
                            <td><code>/threat-intel/help</code></td>
                        </tr>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Action Buttons -->
    <div class="text-center">
        <a href="{{ url_for('threat_intel.dashboard') }}" class="btn btn-primary btn-lg">
            <i class="bi bi-speedometer2"></i> Go to Dashboard
        </a>
        <a href="{{ url_for('threat_intel.search') }}" class="btn btn-success btn-lg">
            <i class="bi bi-search"></i> Start Searching
        </a>
        <a href="{{ url_for('threat_intel.public_report') }}" class="btn btn-info btn-lg" target="_blank">
            <i class="bi bi-megaphone"></i> Public Reporting Form
        </a>
    </div>
</div>
{% endblock %}
